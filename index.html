<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(ellipse at center, #0a0e27 0%, #020308 100%);
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
        }

        /* Starfield background */
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* Main canvas */
        #solarSystem {
            position: absolute;
            top: 0;
            left: 0;
            cursor: grab;
            z-index: 1;
        }

        #solarSystem:active {
            cursor: grabbing;
        }

        /* Control panel */
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(10, 14, 39, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            z-index: 10;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            max-width: 280px;
        }

        .controls h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #6dd5ed;
            text-shadow: 0 0 10px rgba(109, 213, 237, 0.5);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            flex: 1;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.6);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
        }

        .toggle-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .toggle-btn {
            padding: 8px 12px;
            font-size: 11px;
            flex: none;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .value-display {
            display: inline-block;
            margin-left: 8px;
            color: #6dd5ed;
            font-weight: bold;
        }

        /* Info card */
        .info-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(109, 213, 237, 0.5);
            border-radius: 16px;
            padding: 30px;
            z-index: 100;
            max-width: 400px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7);
            transition: transform 0.3s ease;
        }

        .info-card.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .info-card h3 {
            font-size: 28px;
            margin-bottom: 15px;
            color: #6dd5ed;
            text-shadow: 0 0 15px rgba(109, 213, 237, 0.7);
        }

        .info-card .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        .info-card .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #a0a0a0;
            font-size: 13px;
        }

        .info-value {
            color: #ffffff;
            font-weight: bold;
            font-size: 13px;
        }

        .fun-fact {
            margin-top: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.6;
            color: #d0d0d0;
        }

        /* Legend */
        .legend {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(10, 14, 39, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 12px;
            padding: 15px;
            z-index: 10;
            font-size: 11px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            box-shadow: 0 0 10px currentColor;
        }

        /* Loading screen */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #020308;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-size: 24px;
            color: #6dd5ed;
            text-shadow: 0 0 20px rgba(109, 213, 237, 0.8);
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .controls {
                top: 10px;
                left: 10px;
                right: 10px;
                max-width: none;
                padding: 15px;
            }

            .legend {
                bottom: 10px;
                right: 10px;
                font-size: 10px;
            }

            .info-card {
                max-width: 90%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div class="loading" id="loading">
        <div class="loading-text">Initializing Solar System...</div>
    </div>

    <!-- Starfield background -->
    <canvas id="starfield"></canvas>

    <!-- Main solar system canvas -->
    <canvas id="solarSystem"></canvas>

    <!-- Control panel -->
    <div class="controls">
        <h2>‚öôÔ∏è Controls</h2>
        
        <div class="control-group">
            <div class="btn-group">
                <button id="playPauseBtn">‚è∏Ô∏è Pause</button>
                <button id="resetBtn">üîÑ Reset</button>
            </div>
        </div>

        <div class="control-group">
            <label>Speed <span class="value-display" id="speedValue">1.0x</span></label>
            <input type="range" id="speedSlider" min="0" max="10" step="0.5" value="1">
        </div>

        <div class="control-group">
            <label>Zoom <span class="value-display" id="zoomValue">1.0x</span></label>
            <input type="range" id="zoomSlider" min="0.3" max="3" step="0.1" value="1">
        </div>

        <div class="control-group">
            <label>Options</label>
            <div class="toggle-group">
                <button class="toggle-btn active" id="orbitsBtn">Orbits</button>
                <button class="toggle-btn active" id="trailsBtn">Trails</button>
                <button class="toggle-btn active" id="labelsBtn">Labels</button>
                <button class="toggle-btn" id="asteroidsBtn">Asteroids</button>
            </div>
        </div>
    </div>

    <!-- Info card -->
    <div class="info-card" id="infoCard">
        <button class="close-btn" id="closeInfoBtn">√ó</button>
        <h3 id="infoName"></h3>
        <div id="infoContent"></div>
    </div>

    <!-- Legend -->
    <div class="legend">
        <div style="font-weight: bold; margin-bottom: 10px; color: #6dd5ed;">Navigation</div>
        <div style="margin-bottom: 5px;">üñ±Ô∏è Drag to pan</div>
        <div style="margin-bottom: 5px;">üîç Scroll to zoom</div>
        <div>üëÜ Click objects for info</div>
    </div>

    <script>
        // ============================================
        // SOLAR SYSTEM DATA
        // ============================================
        const SOLAR_SYSTEM_DATA = {
            sun: {
                name: "Sun",
                radius: 30,
                color: "#FDB813",
                glowColor: "rgba(253, 184, 19, 0.6)",
                type: "star",
                funFact: "The Sun contains 99.86% of the mass in our Solar System and could fit 1.3 million Earths inside it!"
            },
            planets: [
                {
                    name: "Mercury",
                    radius: 4,
                    color: "#8C7853",
                    orbitRadius: 80,
                    orbitSpeed: 4.74,
                    rotationSpeed: 0.01,
                    eccentricity: 0.206,
                    realRadius: 2439,
                    orbitPeriod: "88 days",
                    rotationPeriod: "59 days",
                    funFact: "Mercury has the most eccentric orbit and experiences extreme temperature swings from -173¬∞C to 427¬∞C.",
                    moons: []
                },
                {
                    name: "Venus",
                    radius: 9,
                    color: "#FFC649",
                    orbitRadius: 120,
                    orbitSpeed: 3.50,
                    rotationSpeed: -0.005,
                    eccentricity: 0.007,
                    realRadius: 6052,
                    orbitPeriod: "225 days",
                    rotationPeriod: "243 days (retrograde)",
                    funFact: "Venus rotates backwards and has the longest day of any planet - longer than its year!",
                    moons: []
                },
                {
                    name: "Earth",
                    radius: 10,
                    color: "#4169E1",
                    orbitRadius: 165,
                    orbitSpeed: 2.98,
                    rotationSpeed: 0.02,
                    eccentricity: 0.017,
                    realRadius: 6371,
                    orbitPeriod: "365.25 days",
                    rotationPeriod: "24 hours",
                    funFact: "Earth is the only known planet with liquid water on its surface and the only one known to harbor life.",
                    moons: [
                        {
                            name: "Moon",
                            radius: 3,
                            color: "#C0C0C0",
                            orbitRadius: 20,
                            orbitSpeed: 1.0,
                            funFact: "The Moon is slowly moving away from Earth at about 3.8 cm per year."
                        }
                    ]
                },
                {
                    name: "Mars",
                    radius: 6,
                    color: "#CD5C5C",
                    orbitRadius: 210,
                    orbitSpeed: 2.41,
                    rotationSpeed: 0.018,
                    eccentricity: 0.093,
                    realRadius: 3390,
                    orbitPeriod: "687 days",
                    rotationPeriod: "24.6 hours",
                    funFact: "Mars has the largest volcano in the Solar System - Olympus Mons, which is 21 km high!",
                    moons: [
                        {
                            name: "Phobos",
                            radius: 1.5,
                            color: "#8B7765",
                            orbitRadius: 12,
                            orbitSpeed: 2.5,
                            funFact: "Phobos orbits Mars faster than Mars rotates, rising in the west and setting in the east."
                        }
                    ]
                },
                {
                    name: "Jupiter",
                    radius: 22,
                    color: "#DAA520",
                    orbitRadius: 300,
                    orbitSpeed: 1.31,
                    rotationSpeed: 0.04,
                    eccentricity: 0.048,
                    realRadius: 69911,
                    orbitPeriod: "11.9 years",
                    rotationPeriod: "9.9 hours",
                    funFact: "Jupiter's Great Red Spot is a storm larger than Earth that has raged for at least 400 years!",
                    moons: [
                        {
                            name: "Io",
                            radius: 2.5,
                            color: "#FFD700",
                            orbitRadius: 32,
                            orbitSpeed: 1.8,
                            funFact: "Io is the most volcanically active body in the Solar System."
                        },
                        {
                            name: "Europa",
                            radius: 2.3,
                            color: "#F0E68C",
                            orbitRadius: 40,
                            orbitSpeed: 1.4,
                            funFact: "Europa may have a subsurface ocean with twice as much water as Earth."
                        }
                    ]
                },
                {
                    name: "Saturn",
                    radius: 20,
                    color: "#F4A460",
                    orbitRadius: 400,
                    orbitSpeed: 0.97,
                    rotationSpeed: 0.038,
                    eccentricity: 0.056,
                    realRadius: 58232,
                    orbitPeriod: "29.5 years",
                    rotationPeriod: "10.7 hours",
                    funFact: "Saturn's rings are made of billions of ice particles, some as small as grains of sand!",
                    hasRings: true,
                    moons: [
                        {
                            name: "Titan",
                            radius: 3,
                            color: "#FFB347",
                            orbitRadius: 35,
                            orbitSpeed: 1.2,
                            funFact: "Titan is larger than Mercury and has a thick atmosphere with methane lakes."
                        }
                    ]
                },
                {
                    name: "Uranus",
                    radius: 14,
                    color: "#4FD0E0",
                    orbitRadius: 500,
                    orbitSpeed: 0.68,
                    rotationSpeed: -0.03,
                    eccentricity: 0.047,
                    realRadius: 25362,
                    orbitPeriod: "84 years",
                    rotationPeriod: "17.2 hours (retrograde)",
                    funFact: "Uranus rotates on its side, possibly due to a massive collision in its past.",
                    moons: [
                        {
                            name: "Titania",
                            radius: 2,
                            color: "#87CEEB",
                            orbitRadius: 25,
                            orbitSpeed: 1.0,
                            funFact: "Titania is Uranus's largest moon and has huge canyons up to 1,500 km long."
                        }
                    ]
                },
                {
                    name: "Neptune",
                    radius: 14,
                    color: "#4169E1",
                    orbitRadius: 580,
                    orbitSpeed: 0.54,
                    rotationSpeed: 0.032,
                    eccentricity: 0.009,
                    realRadius: 24622,
                    orbitPeriod: "165 years",
                    rotationPeriod: "16.1 hours",
                    funFact: "Neptune has the strongest winds in the Solar System, reaching speeds of 2,100 km/h!",
                    moons: [
                        {
                            name: "Triton",
                            radius: 2.5,
                            color: "#B0C4DE",
                            orbitRadius: 28,
                            orbitSpeed: -1.5,
                            funFact: "Triton orbits Neptune backwards and is slowly spiraling toward the planet."
                        }
                    ]
                }
            ]
        };

        // ============================================
        // CANVAS SETUP
        // ============================================
        const canvas = document.getElementById('solarSystem');
        const ctx = canvas.getContext('2d');
        const starfieldCanvas = document.getElementById('starfield');
        const starfieldCtx = starfieldCanvas.getContext('2d');

        let width = canvas.width = starfieldCanvas.width = window.innerWidth;
        let height = canvas.height = starfieldCanvas.height = window.innerHeight;
        let centerX = width / 2;
        let centerY = height / 2;

        // ============================================
        // SIMULATION STATE
        // ============================================
        let state = {
            running: true,
            speed: 1.0,
            zoom: 1.0,
            offsetX: 0,
            offsetY: 0,
            showOrbits: true,
            showTrails: true,
            showLabels: true,
            showAsteroids: false,
            time: 0,
            selectedBody: null
        };

        // Camera control variables
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let lastOffsetX = 0;
        let lastOffsetY = 0;

        // Trail storage
        const trails = new Map();

        // ============================================
        // STARFIELD GENERATION
        // ============================================
        const stars = [];
        const numStars = 200;

        function generateStarfield() {
            for (let i = 0; i < numStars; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    radius: Math.random() * 1.5,
                    opacity: Math.random() * 0.5 + 0.3,
                    twinkleSpeed: Math.random() * 0.02 + 0.01
                });
            }
        }

        function drawStarfield() {
            starfieldCtx.clearRect(0, 0, width, height);
            stars.forEach(star => {
                star.opacity += star.twinkleSpeed * Math.sin(state.time * 0.01);
                if (star.opacity > 1) star.opacity = 1;
                if (star.opacity < 0.3) star.opacity = 0.3;
                
                starfieldCtx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                starfieldCtx.beginPath();
                starfieldCtx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                starfieldCtx.fill();
            });
        }

        // ============================================
        // ASTEROID BELT
        // ============================================
        const asteroids = [];
        const numAsteroids = 300;

        function generateAsteroids() {
            for (let i = 0; i < numAsteroids; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = 240 + Math.random() * 40;
                asteroids.push({
                    angle: angle,
                    radius: radius,
                    speed: 0.0003 + Math.random() * 0.0002,
                    size: Math.random() * 1.5 + 0.5
                });
            }
        }

        // ============================================
        // CELESTIAL BODY CLASS
        // ============================================
        class CelestialBody {
            constructor(data, parent = null) {
                this.name = data.name;
                this.radius = data.radius;
                this.color = data.color;
                this.orbitRadius = data.orbitRadius || 0;
                this.orbitSpeed = data.orbitSpeed || 0;
                this.rotationSpeed = data.rotationSpeed || 0;
                this.eccentricity = data.eccentricity || 0;
                this.angle = Math.random() * Math.PI * 2;
                this.rotation = 0;
                this.parent = parent;
                this.moons = [];
                this.hasRings = data.hasRings || false;
                this.type = data.type || 'planet';
                this.glowColor = data.glowColor;
                
                // Store additional info for display
                this.info = {
                    realRadius: data.realRadius,
                    orbitPeriod: data.orbitPeriod,
                    rotationPeriod: data.rotationPeriod,
                    funFact: data.funFact
                };

                // Initialize trail
                if (this.type !== 'star') {
                    trails.set(this.name, []);
                }

                // Create moons
                if (data.moons) {
                    data.moons.forEach(moonData => {
                        this.moons.push(new CelestialBody(moonData, this));
                    });
                }
            }

            update(deltaTime) {
                if (this.parent) {
                    this.angle += this.orbitSpeed * 0.001 * state.speed * deltaTime;
                } else if (this.type !== 'star') {
                    this.angle += this.orbitSpeed * 0.001 * state.speed * deltaTime;
                }
                
                this.rotation += this.rotationSpeed * state.speed * deltaTime;

                // Update trail
                if (state.showTrails && this.type !== 'star') {
                    const pos = this.getPosition();
                    const trail = trails.get(this.name);
                    if (trail) {
                        trail.push({ x: pos.x, y: pos.y });
                        if (trail.length > 100) {
                            trail.shift();
                        }
                    }
                }

                // Update moons
                this.moons.forEach(moon => moon.update(deltaTime));
            }

            getPosition() {
                if (this.type === 'star') {
                    return { x: centerX + state.offsetX, y: centerY + state.offsetY };
                }

                const parentPos = this.parent ? this.parent.getPosition() : { x: centerX + state.offsetX, y: centerY + state.offsetY };
                
                // Elliptical orbit calculation
                const a = this.orbitRadius * state.zoom; // Semi-major axis
                const b = a * (1 - this.eccentricity); // Semi-minor axis
                
                const x = parentPos.x + a * Math.cos(this.angle);
                const y = parentPos.y + b * Math.sin(this.angle);
                
                return { x, y };
            }

            draw() {
                const pos = this.getPosition();

                // Draw orbit path
                if (state.showOrbits && this.orbitRadius > 0) {
                    const parentPos = this.parent ? this.parent.getPosition() : { x: centerX + state.offsetX, y: centerY + state.offsetY };
                    ctx.strokeStyle = 'rgba(100, 150, 255, 0.2)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    
                    const a = this.orbitRadius * state.zoom;
                    const b = a * (1 - this.eccentricity);
                    
                    ctx.ellipse(parentPos.x, parentPos.y, a, b, 0, 0, Math.PI * 2);
                    ctx.stroke();
                }

                // Draw trail
                if (state.showTrails && this.type !== 'star') {
                    const trail = trails.get(this.name);
                    if (trail && trail.length > 1) {
                        ctx.strokeStyle = this.color;
                        ctx.lineWidth = 1;
                        ctx.globalAlpha = 0.3;
                        ctx.beginPath();
                        ctx.moveTo(trail[0].x, trail[0].y);
                        for (let i = 1; i < trail.length; i++) {
                            ctx.lineTo(trail[i].x, trail[i].y);
                        }
                        ctx.stroke();
                        ctx.globalAlpha = 1.0;
                    }
                }

                // Draw glow for sun
                if (this.type === 'star') {
                    const gradient = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, this.radius * state.zoom * 2);
                    gradient.addColorStop(0, this.glowColor);
                    gradient.addColorStop(0.5, 'rgba(253, 184, 19, 0.2)');
                    gradient.addColorStop(1, 'rgba(253, 184, 19, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y, this.radius * state.zoom * 2, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Draw planet/moon body
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, this.radius * state.zoom, 0, Math.PI * 2);
                ctx.fill();

                // Add subtle highlight
                const highlightGradient = ctx.createRadialGradient(
                    pos.x - this.radius * state.zoom * 0.3,
                    pos.y - this.radius * state.zoom * 0.3,
                    0,
                    pos.x,
                    pos.y,
                    this.radius * state.zoom
                );
                highlightGradient.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                highlightGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = highlightGradient;
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, this.radius * state.zoom, 0, Math.PI * 2);
                ctx.fill();

                // Draw rings for Saturn
                if (this.hasRings) {
                    ctx.strokeStyle = 'rgba(244, 164, 96, 0.6)';
                    ctx.lineWidth = 3 * state.zoom;
                    ctx.beginPath();
                    ctx.ellipse(pos.x, pos.y, this.radius * state.zoom * 1.8, this.radius * state.zoom * 0.4, 0, 0, Math.PI * 2);
                    ctx.stroke();
                }

                // Draw label
                if (state.showLabels && state.zoom > 0.5) {
                    ctx.fillStyle = '#ffffff';
                    ctx.font = `${Math.max(10, 12 * state.zoom)}px sans-serif`;
                    ctx.textAlign = 'center';
                    ctx.fillText(this.name, pos.x, pos.y + this.radius * state.zoom + 15);
                }

                // Draw moons
                this.moons.forEach(moon => moon.draw());
            }

            isPointInside(x, y) {
                const pos = this.getPosition();
                const distance = Math.sqrt((x - pos.x) ** 2 + (y - pos.y) ** 2);
                return distance <= this.radius * state.zoom;
            }

            getAllBodies() {
                let bodies = [this];
                this.moons.forEach(moon => {
                    bodies = bodies.concat(moon.getAllBodies());
                });
                return bodies;
            }
        }

        // ============================================
        // INITIALIZE SOLAR SYSTEM
        // ============================================
        let sun;
        let planets = [];

        function initSolarSystem() {
            sun = new CelestialBody(SOLAR_SYSTEM_DATA.sun);
            planets = SOLAR_SYSTEM_DATA.planets.map(data => new CelestialBody(data));
            generateStarfield();
            generateAsteroids();
        }

        // ============================================
        // ANIMATION LOOP
        // ============================================
        let lastTime = performance.now();

        function animate(currentTime) {
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;

            // Clear canvas
            ctx.clearRect(0, 0, width, height);

            // Update time
            if (state.running) {
                state.time += deltaTime * state.speed;
            }

            // Draw starfield
            drawStarfield();

            // Draw asteroids
            if (state.showAsteroids) {
                asteroids.forEach(asteroid => {
                    if (state.running) {
                        asteroid.angle += asteroid.speed * state.speed * deltaTime;
                    }
                    const x = centerX + state.offsetX + asteroid.radius * state.zoom * Math.cos(asteroid.angle);
                    const y = centerY + state.offsetY + asteroid.radius * state.zoom * Math.sin(asteroid.angle);
                    
                    ctx.fillStyle = 'rgba(150, 150, 150, 0.5)';
                    ctx.beginPath();
                    ctx.arc(x, y, asteroid.size * state.zoom, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            // Update and draw sun
            sun.draw();

            // Update and draw planets
            if (state.running) {
                planets.forEach(planet => planet.update(deltaTime));
            }
            planets.forEach(planet => planet.draw());

            requestAnimationFrame(animate);
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================

        // Play/Pause
        document.getElementById('playPauseBtn').addEventListener('click', () => {
            state.running = !state.running;
            document.getElementById('playPauseBtn').textContent = state.running ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
        });

        // Reset
        document.getElementById('resetBtn').addEventListener('click', () => {
            state.offsetX = 0;
            state.offsetY = 0;
            state.zoom = 1.0;
            state.time = 0;
            document.getElementById('zoomSlider').value = 1.0;
            document.getElementById('zoomValue').textContent = '1.0x';
            
            // Reset planet positions
            planets.forEach(planet => {
                planet.angle = Math.random() * Math.PI * 2;
                planet.rotation = 0;
                planet.moons.forEach(moon => {
                    moon.angle = Math.random() * Math.PI * 2;
                    moon.rotation = 0;
                });
            });

            // Clear trails
            trails.forEach((trail, key) => {
                trails.set(key, []);
            });
        });

        // Speed control
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            state.speed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = state.speed.toFixed(1) + 'x';
        });

        // Zoom control
        document.getElementById('zoomSlider').addEventListener('input', (e) => {
            state.zoom = parseFloat(e.target.value);
            document.getElementById('zoomValue').textContent = state.zoom.toFixed(1) + 'x';
        });

        // Toggle buttons
        document.getElementById('orbitsBtn').addEventListener('click', function() {
            state.showOrbits = !state.showOrbits;
            this.classList.toggle('active');
        });

        document.getElementById('trailsBtn').addEventListener('click', function() {
            state.showTrails = !state.showTrails;
            this.classList.toggle('active');
            if (!state.showTrails) {
                trails.forEach((trail, key) => {
                    trails.set(key, []);
                });
            }
        });

        document.getElementById('labelsBtn').addEventListener('click', function() {
            state.showLabels = !state.showLabels;
            this.classList.toggle('active');
        });

        document.getElementById('asteroidsBtn').addEventListener('click', function() {
            state.showAsteroids = !state.showAsteroids;
            this.classList.toggle('active');
        });

        // Mouse/Touch controls for panning
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            lastOffsetX = state.offsetX;
            lastOffsetY = state.offsetY;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                state.offsetX = lastOffsetX + (e.clientX - dragStartX);
                state.offsetY = lastOffsetY + (e.clientY - dragStartY);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                isDragging = true;
                dragStartX = e.touches[0].clientX;
                dragStartY = e.touches[0].clientY;
                lastOffsetX = state.offsetX;
                lastOffsetY = state.offsetY;
                e.preventDefault();
            }
        });

        canvas.addEventListener('touchmove', (e) => {
            if (isDragging && e.touches.length === 1) {
                state.offsetX = lastOffsetX + (e.touches[0].clientX - dragStartX);
                state.offsetY = lastOffsetY + (e.touches[0].clientY - dragStartY);
                e.preventDefault();
            }
        });

        canvas.addEventListener('touchend', () => {
            isDragging = false;
        });

        // Zoom with mouse wheel
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
            state.zoom = Math.max(0.3, Math.min(3, state.zoom * zoomFactor));
            document.getElementById('zoomSlider').value = state.zoom;
            document.getElementById('zoomValue').textContent = state.zoom.toFixed(1) + 'x';
        }, { passive: false });

        // Click to show info
        canvas.addEventListener('click', (e) => {
            if (isDragging) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Check sun
            if (sun.isPointInside(x, y)) {
                showInfo(sun);
                return;
            }

            // Check planets and moons
            for (let planet of planets) {
                const allBodies = planet.getAllBodies();
                for (let body of allBodies) {
                    if (body.isPointInside(x, y)) {
                        showInfo(body);
                        return;
                    }
                }
            }
        });

        // Info card
        function showInfo(body) {
            const infoCard = document.getElementById('infoCard');
            const infoName = document.getElementById('infoName');
            const infoContent = document.getElementById('infoContent');

            infoName.textContent = body.name;

            let html = '';
            if (body.type === 'star') {
                html = `
                    <div class="info-row">
                        <span class="info-label">Type</span>
                        <span class="info-value">G-type Main Sequence Star</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temperature</span>
                        <span class="info-value">5,778 K (surface)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Age</span>
                        <span class="info-value">~4.6 billion years</span>
                    </div>
                `;
            } else {
                html = `
                    <div class="info-row">
                        <span class="info-label">Radius</span>
                        <span class="info-value">${body.info.realRadius ? body.info.realRadius.toLocaleString() + ' km' : 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Orbit Period</span>
                        <span class="info-value">${body.info.orbitPeriod || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Rotation Period</span>
                        <span class="info-value">${body.info.rotationPeriod || 'N/A'}</span>
                    </div>
                `;
            }

            if (body.info.funFact) {
                html += `<div class="fun-fact"><strong>üí° Did you know?</strong><br>${body.info.funFact}</div>`;
            }

            infoContent.innerHTML = html;
            infoCard.classList.add('show');
        }

        document.getElementById('closeInfoBtn').addEventListener('click', () => {
            document.getElementById('infoCard').classList.remove('show');
        });

        // Close info card when clicking outside
        document.addEventListener('click', (e) => {
            const infoCard = document.getElementById('infoCard');
            if (!infoCard.contains(e.target) && !canvas.contains(e.target)) {
                infoCard.classList.remove('show');
            }
        });

        // Window resize
        window.addEventListener('resize', () => {
            width = canvas.width = starfieldCanvas.width = window.innerWidth;
            height = canvas.height = starfieldCanvas.height = window.innerHeight;
            centerX = width / 2;
            centerY = height / 2;
            
            // Regenerate starfield
            stars.length = 0;
            generateStarfield();
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        initSolarSystem();

        // Hide loading screen and start animation
        setTimeout(() => {
            document.getElementById('loading').classList.add('hidden');
            requestAnimationFrame(animate);
        }, 1000);
    </script>
</body>
<!-- tu·∫•n l·ªè -->
</html>